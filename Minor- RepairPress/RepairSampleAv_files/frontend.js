var ptssRepairPress=ptssRepairPress||{};ptssRepairPress.events={};_.extend(ptssRepairPress.events,Backbone.Events);jQuery(document).ready(function($){new ptssRepairPress.frameView({el:'.js-ptss-frame',model:new ptssRepairPress.Frame(),});new ptssRepairPress.customizerCSS({el:'#repairpress-main-inline-css',});new ptssRepairPress.pageLayoutView({el:'#ptss__layout',model:ptssRepairPress.PageLayout,});new ptssRepairPress.navPositionView({el:'#ptss__nav-position',model:new ptssRepairPress.NavPosition(),});new ptssRepairPress.colorPaletteView({el:'#ptss__color-skin',});new ptssRepairPress.bgImgsView({el:'#ptss__boxed-bg',});});(function(){var $=jQuery;ptssRepairPress.Frame=Backbone.Model.extend({defaults:{isVisible:false,},initialize:function(){var current=localStorage.getItem(ptssVars.siteId+'_isVisible');if(null===current){this.set('isVisible',true);setTimeout(_.bind(this.toggleVisibility,this),2000);}
else{this.set('isVisible','true'===current);}},toggleVisibility:function(){this.set('isVisible',!this.get('isVisible'));localStorage.setItem(ptssVars.siteId+'_isVisible',this.get('isVisible'));},});ptssRepairPress.frameView=Backbone.View.extend({events:{'click .js-ptss-toggle-btn':'toggleVisibility',},initialize:function(){this.listenTo(this.model,'change',this.toggleClass);this.model.trigger('change');},toggleVisibility:function(){this.model.toggleVisibility();},toggleClass:function(){this.$el.toggleClass('is-opened',this.model.get('isVisible'));},});(function(){var Layout=Backbone.Model.extend({defaults:{isBoxed:false,},initialize:function(){this.listenTo(this,'change',this.bodyClass);this.set('isBoxed','true'===localStorage.getItem(ptssVars.siteId+'_isBoxed'));},switchLayout:function(){this.set('isBoxed',!this.get('isBoxed'));localStorage.setItem(ptssVars.siteId+'_isBoxed',this.get('isBoxed'));ptssRepairPress.events.trigger('toggleLayoutStyle',this.get('isBoxed'));$(window).trigger('resize');},bodyClass:function(){$('body').toggleClass('boxed',this.get('isBoxed'));},});ptssRepairPress.PageLayout=new Layout();})();ptssRepairPress.NavPosition=Backbone.Model.extend({defaults:{isSticky:false,},initialize:function(){this.listenTo(this,'change',this.updateNavPosition);this.set('isSticky','true'===localStorage.getItem(ptssVars.siteId+'_isSticky'));},toggleNavPosition:function(){this.set('isSticky',!this.get('isSticky'));localStorage.setItem(ptssVars.siteId+'_isSticky',this.get('isSticky'));},updateNavPosition:function(){$('body').toggleClass('sticky-navigation',this.get('isSticky'));$('body').trigger('update_sticky_state.pt');},});ptssRepairPress.ColorSkin=Backbone.Model.extend({defaults:{isSelected:false,color:'',},initialize:function(){this.listenTo(this,'change:isSelected',this.applySkin);},applySkin:function(){if(this.get('isSelected')){ptssRepairPress.events.trigger('updateCSS');localStorage.setItem(ptssVars.siteId+'_colorSkin',this.get('color'));}},});ptssRepairPress.colorPaletteCollection=Backbone.Collection.extend({model:ptssRepairPress.ColorSkin,initialize:function(){setTimeout(_.bind(this.setDefaultSkin,this),20);},setDefaultSkin:function(){var current=localStorage.getItem(ptssVars.siteId+'_colorSkin');if(null===current){this.first().set('isSelected',true);}
else{this.find(function(colorSkin){return current===colorSkin.get('color');}).set('isSelected',true);}}});ptssRepairPress.colorPalette=new ptssRepairPress.colorPaletteCollection([{color:'default',css:{primary:'#3baed4',primaryDarken5:'#2ea1c7',primaryDarken15:'#1588ae',primaryLighten8:'#4fc2e8',topBar:'#25426f',topBarDarken1:'#223f6c',topBarDarken5:'#183562',topBarLighten20:'#5875a2',topBarFont:'#aab0be',footerFont:'#aab5c9',footerBg:'#223d67',primaryBg:'#2f538a',headerFont:'#c7cedb',bannerStart:'#25426f',bannerStop:'#2f538a',},},{color:'darkBlue',css:{primary:'#30bbd0',primaryDarken5:'#2aa8bb',primaryDarken15:'#218391',primaryLighten8:'#55c7d8',topBar:'#28323d',topBarDarken1:'#242d37',topBarDarken5:'#1c232b',topBarLighten20:'#51657b',topBarFont:'#8a8d90',footerFont:'#8a8d90',footerBg:'#28323d',primaryBg:'#2f3c4a',headerFont:'#acb0b4',bannerStart:'#1f2730',bannerStop:'#28323d',},},{color:'gray',css:{primary:'#ecac00',primaryDarken5:'#d19800',primaryDarken15:'#9e7300',primaryLighten8:'#ffc11a',topBar:'#333333',topBarDarken1:'#303030',topBarDarken5:'#262626',topBarLighten20:'#666666',topBarFont:'#848484',footerFont:'#848484',footerBg:'#333333',primaryBg:'#444444',headerFont:'#b2b2b2',bannerStart:'#2e2e2e',bannerStop:'#333333',},},{color:'grassGreen',css:{primary:'#91bd52',primaryDarken5:'#84b144',primaryDarken15:'#698c36',primaryLighten8:'#a6c973',topBar:'#333333',topBarDarken1:'#303030',topBarDarken5:'#262626',topBarLighten20:'#666666',topBarFont:'#adadad',footerFont:'#adadad',footerBg:'#333333',primaryBg:'#444444',headerFont:'#cccccc',bannerStart:'#2e2e2e',bannerStop:'#333333',},},{color:'red',css:{primary:'#ff5a34',primaryDarken5:'#ff441a',primaryDarken15:'#e62b00',primaryLighten8:'#ff7e61',topBar:'#5c5652',topBarDarken1:'#59534f',topBarDarken5:'#4e4946',topBarLighten20:'#938b86',topBarFont:'#b7b5b4',footerFont:'#b7b5b4',footerBg:'#5c5652',primaryBg:'#6f6660',headerFont:'#d5d3d2',bannerStart:'#4f4946',bannerStop:'#5c5652',},},{color:'gold',css:{primary:'#e2ad1d',primaryDarken5:'#cb9c1a',primaryDarken15:'#9e7914',primaryLighten8:'#e7ba41',topBar:'#05614b',topBarDarken1:'#055c47',topBarDarken5:'#044938',topBarLighten20:'#0ac296',topBarFont:'#a5b9b2',footerFont:'#a5b9b2',footerBg:'#05614b',primaryBg:'#067c61',headerFont:'#c4d8d2',bannerStart:'#045542',bannerStop:'#05614b',},},]);ptssRepairPress.BgImage=Backbone.Model.extend({defaults:{isSelected:false,repeatable:false,name:'',src:{},},initialize:function(){this.listenTo(this,'change:isSelected',this.updateBgImage);},updateBgImage:function(){if(this.get('isSelected')){ptssRepairPress.events.trigger('updateBgImage');localStorage.setItem(ptssVars.siteId+'_bgImage',this.get('name'));$('body').css('background-image','url("'+ ptssVars.pathToPlugin+'assets/img/'+ this.get('src')+'")');}},});ptssRepairPress.bgImgsCollection=Backbone.Collection.extend({model:ptssRepairPress.BgImage,initialize:function(){setTimeout(_.bind(this.setDefaultBg,this),20);},setDefaultBg:function(){var current=localStorage.getItem(ptssVars.siteId+'_bgImage');if(null===current){this.first().set('isSelected',true);}
else{this.find(function(bgImg){return current===bgImg.get('name');}).set('isSelected',true);}}});ptssRepairPress.bgImgs=new ptssRepairPress.bgImgsCollection([{name:'pattern1',src:'1.png',sprite:1,},{name:'pattern2',src:'2.png',sprite:2,},{name:'pattern3',src:'3.png',sprite:3,},{name:'pattern4',src:'4.png',sprite:4,},{name:'pattern5',src:'5.png',sprite:5,},{name:'pattern6',src:'6.png',sprite:6,},]);ptssRepairPress.pageLayoutView=Backbone.View.extend({events:{'click .ptss__layout-box--wide':'changeToWide','click .ptss__layout-box--boxed':'changeToBoxed',},template:_.template($('#ptss-layout-tmpl').html()),initialize:function(){this.listenTo(this.model,'change',this.render);this.render();return this;},render:function(){this.$('.ptss__setting-control').html(this.template(this.model.attributes));return this;},changeToWide:function(ev){if(this.model.get('isBoxed')){this.model.switchLayout();}
$('body').css('background-image','none');return this;},changeToBoxed:function(ev){if(!this.model.get('isBoxed')){this.model.switchLayout();}
return this;},});ptssRepairPress.navPositionView=Backbone.View.extend({events:{'click .ptss__setting-control':'changeNavPosition',},template:_.template($('#ptss-nav-tmpl').html()),initialize:function(){this.listenTo(this.model,'change',this.render);3
this.render();return this;},render:function(){this.$('.ptss__setting-control').html(this.template(this.model.attributes));return this;},changeNavPosition:function(){this.model.toggleNavPosition();return this;},});ptssRepairPress.colorSkinView=Backbone.View.extend({events:{'click':'changeToThisSkin',},template:'<i class="fa fa-check"></i>',tagName:'span',className:'ptss__color-option',initialize:function(){this.listenTo(this.model,'change:isSelected',this.updateSelected);this.model.trigger('change:isSelected');return this;},render:function(){this.$el.html(this.template);this.$el.css('background-color',this.model.attributes.css.primary);return this;},changeToThisSkin:function(){ptssRepairPress.colorPalette.each(function(colorSkin){colorSkin.set('isSelected',false);});this.model.set('isSelected',true);return this;},updateSelected:function(){this.$el.toggleClass('is-selected',this.model.get('isSelected'));return this;},});ptssRepairPress.colorPaletteView=Backbone.View.extend({initialize:function(){ptssRepairPress.colorPalette.each(this.addColorSkin,this);return this;},addColorSkin:function(colorSkin){var skinView=new ptssRepairPress.colorSkinView({model:colorSkin,});this.$el.append(skinView.render().el);},});ptssRepairPress.bgImgView=Backbone.View.extend({events:{'click':'changeToThisBgImg',},template:'<i class="fa fa-check"></i>',tagName:'span',className:'ptss__bgimg-option',initialize:function(){this.listenTo(this.model,'change:isSelected',this.updateSelected);this.model.trigger('change:isSelected');return this;},render:function(){this.$el.html(this.template);this.$el.css('background-position','-'+((this.model.get('sprite')- 1)*42)+'px 0');return this;},changeToThisBgImg:function(){ptssRepairPress.bgImgs.each(function(bgImg){bgImg.set('isSelected',false);});this.model.set('isSelected',true);return this;},updateSelected:function(){this.$el.toggleClass('is-selected',this.model.get('isSelected'));return this;},});ptssRepairPress.bgImgsView=Backbone.View.extend({initialize:function(){this.listenTo(ptssRepairPress.events,'toggleLayoutStyle',this.toggleVisibility);ptssRepairPress.bgImgs.each(this.addBgImgs,this);this.toggleVisibility(ptssRepairPress.PageLayout.get('isBoxed'));return this;},addBgImgs:function(bgImg){var bgImgView=new ptssRepairPress.bgImgView({model:bgImg,});this.$('#ptss__boxed-backgrounds').append(bgImgView.render().el);},toggleVisibility:function(isBoxed){this.$el.toggle(isBoxed);},});ptssRepairPress.customizerCSS=Backbone.View.extend({initialize:function(){this.listenTo(ptssRepairPress.events,'updateCSS',this.render);this.initialCSS=this.$el.text();this.defaultSkin=ptssRepairPress.colorPalette.findWhere({color:'default'});this.template=this.createTemplate(this.initialCSS);return this;},createTemplate:function(templateString){_.each(this.defaultSkin.get('css'),function(hexColor,keyName){templateString=templateString.replace(new RegExp(hexColor,'g'),'<%= '+ keyName+' %>');},this);templateString=templateString+' #pg-15-8 > .panel-row-style {background: linear-gradient(to right, <%= bannerStart %>, <%= bannerStop%>) !important;}';templateString=templateString+' .fa[style*="3baed4"] {color: <%= primary %> !important;}';return _.template(templateString);},render:function(){var selectedSkin=ptssRepairPress.colorPalette.findWhere({isSelected:true});if(selectedSkin===this.defaultSkin){this.$el.text(this.initialCSS);}
else{this.$el.text(this.template(selectedSkin.get('css')));}
return this;},});})();